# 用户登录注册功能实现文档

## 概述

基于当前的 Scene Mesh Workbench 项目，使用 Entity Engine 框架实现了完整的用户登录注册功能。遵循奥卡姆剃刀原则，采用最简洁的方式实现认证系统。

## 功能特性

### ✅ 已实现功能

1. **用户模型定义**
   - 用户基本信息（用户名、邮箱、密码、角色、状态等）
   - 会话管理模型
   - 完整的字段验证和约束

2. **认证视图**
   - 登录表单视图 (`loginFormView`)
   - 注册表单视图 (`registerFormView`)
   - 用户资料视图 (`userProfileView`)
   - 用户列表管理视图 (`userGridView`)
   - 认证页面外壳视图 (`authShellView`)

3. **权限管理系统**
   - 基于角色的权限控制（管理员/普通用户）
   - 用户状态检查（激活/未激活/禁用）
   - 细粒度的操作权限控制

4. **认证工具函数**
   - 简单的 localStorage 会话管理
   - 登录/注册/登出功能
   - 权限检查函数
   - 模拟 API 调用

5. **UI 组件**
   - 认证守卫组件 (`AuthGuard`)
   - 基于 Mantine 的现代化界面
   - 响应式设计
   - 通知系统集成

## 文件结构

```
src/
├── entity/
│   ├── auth/
│   │   ├── auth-utils.ts          # 认证工具函数
│   │   ├── auth-guard.tsx         # 认证守卫组件
│   │   └── auth-handler.tsx       # 认证处理器
│   ├── model-config.ts            # 扩展了用户模型和视图
│   └── provider/
│       └── entity-engine-provider-warpper.tsx  # 增强权限管理
├── app/
│   ├── auth/
│   │   └── page.tsx              # 认证页面
│   ├── api/auth/
│   │   ├── login/route.ts        # 登录 API
│   │   └── register/route.ts     # 注册 API
│   ├── layout.tsx               # 添加通知支持
│   └── page.tsx                 # 主页面（添加认证守卫）
└── README-auth.md               # 本文档
```

## 使用方法

### 1. 访问认证页面

访问 `/auth` 路由即可看到登录注册页面。

### 2. 测试账户

系统预置了以下测试账户：

- **管理员账户**
  - 用户名：`admin`
  - 密码：`123456`
  - 角色：管理员（拥有所有权限）

- **普通用户账户**
  - 用户名：`user`
  - 密码：`123456`
  - 角色：普通用户（有限权限）

### 3. 注册新用户

在认证页面切换到"注册"标签，填写用户信息即可注册新账户。

### 4. 权限控制

- 未登录用户会被重定向到 `/auth` 页面
- 管理员拥有所有权限
- 普通用户只能访问基础功能

## 技术实现

### 1. 模型驱动开发

使用 Entity Engine 的模型配置系统，通过声明式配置自动生成：
- 表单界面
- 数据验证
- CRUD 操作
- 权限控制

### 2. 简单会话管理

采用 localStorage 进行客户端会话管理：
- 登录后保存用户信息和 token
- 自动检查登录状态
- 登出时清除会话数据

### 3. 权限系统集成

与 Entity Engine 的权限系统深度集成：
- 在 `permissionGuard` 中实现认证检查
- 支持基于角色的权限控制
- 细粒度的操作权限管理

### 4. Mantine UI 组件

全面使用 Mantine 组件库：
- 现代化的界面设计
- 响应式布局
- 丰富的交互组件
- 内置通知系统

## 安全考虑

### 当前实现（适合演示和开发）

- 使用 localStorage 存储会话信息
- 简单的密码验证（固定密码）
- 客户端权限检查

### 生产环境建议

1. **服务端认证**
   - 使用 JWT 或 session-based 认证
   - 密码哈希存储（bcrypt）
   - 服务端权限验证

2. **安全增强**
   - HTTPS 传输
   - CSRF 防护
   - 密码复杂度要求
   - 登录失败限制

3. **数据库集成**
   - 真实的用户数据存储
   - 用户信息加密
   - 审计日志记录

## 扩展功能

可以基于当前实现轻松扩展：

1. **忘记密码功能**
2. **邮箱验证**
3. **第三方登录（OAuth）**
4. **多因素认证（2FA）**
5. **用户权限精细化管理**
6. **用户活动日志**

## 开发说明

### 遵循的设计原则

1. **奥卡姆剃刀原则**：选择最简洁的实现方式
2. **模型驱动**：最大化使用 Entity Engine 的配置能力
3. **组件复用**：基于现有架构扩展
4. **类型安全**：全面使用 TypeScript

### 代码风格

- 使用 ESLint 和 Prettier 保持代码一致性
- 详细的注释说明
- 清晰的函数和变量命名
- 模块化的文件组织

## 总结

这个实现展示了如何在 Entity Engine 框架下快速构建用户认证系统。通过模型配置的方式，大大减少了代码量，同时保持了系统的灵活性和可扩展性。

整个实现遵循了框架的设计理念，充分利用了其模型驱动、权限管理和视图生成的能力，为项目提供了完整的用户管理基础。
