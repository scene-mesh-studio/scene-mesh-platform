# 知识库设计文档

## 概述

知识库系统是基于现有内容库构建的智能知识管理平台，支持内容的向量化存储和检索。系统采用分层架构设计，通过知识域、知识库和向量化内容三个层次来组织和管理知识。

## 系统架构

### 1. 数据模型设计

#### 1.1 知识域 (KnowledgeDomain)
- **作用**: 业务领域的顶层分类，如"供应链"、"金融"、"医疗"等
- **字段**:
  - `name`: 域名称
  - `description`: 域描述
  - `icon`: 域图标
  - `color`: 主题色
  - `isActive`: 是否启用
  - `knowledgeBases`: 关联的知识库列表

#### 1.2 知识库 (KnowledgeBase)
- **作用**: 特定领域下的知识库实例
- **字段**:
  - `name`: 知识库名称
  - `description`: 知识库描述
  - `domain`: 所属知识域
  - `embeddingModel`: 向量化模型
  - `chunkSize`: 分块大小
  - `chunkOverlap`: 分块重叠
  - `isActive`: 是否启用
  - `vectorizedContents`: 向量化内容列表

#### 1.3 向量化内容 (VectorizedContent)
- **作用**: 从内容库中向量化后的内容片段
- **字段**:
  - `content`: 原始内容引用
  - `knowledgeBase`: 所属知识库
  - `chunkIndex`: 分块索引
  - `chunkText`: 分块文本
  - `embeddingVector`: 向量数据
  - `metadata`: 元数据
  - `vectorizedAt`: 向量化时间
  - `isActive`: 是否启用

### 2. 工作流程

#### 2.1 知识库创建流程
1. 创建知识域（如"供应链"）
2. 在知识域下创建知识库
3. 配置向量化参数（模型、分块大小等）
4. 从内容库选择内容进行向量化

#### 2.2 内容向量化流程
1. 选择知识库
2. 从内容库选择要向量化的内容
3. 系统自动分块处理
4. 调用向量化模型生成向量
5. 存储向量化结果

#### 2.3 知识检索流程
1. 用户输入查询
2. 系统将查询向量化
3. 在指定知识库中进行向量相似度搜索
4. 返回相关的内容片段

## 技术实现

### 1. 前端组件

#### 1.1 KnowledgeBaseManager
- **位置**: `src/widgets/knowledgeBaseManager/`
- **功能**: 知识库管理的主界面
- **特性**:
  - 知识域管理（创建、编辑、删除）
  - 知识库管理（创建、配置、删除）
  - 内容选择与向量化
  - 向量化内容展示

### 2. 数据存储

#### 2.1 向量存储
- 向量数据以JSON格式存储在数据库中
- 支持多种向量化模型（如OpenAI的text-embedding-ada-002）
- 向量数据包含元数据，便于后续检索和分析

#### 2.2 分块策略
- 支持可配置的分块大小和重叠
- 默认分块大小：1000字符
- 默认重叠大小：200字符
- 分块策略可根据内容类型和需求调整

### 3. API接口

#### 3.1 知识域管理
- `POST /api/ee/knowledgeDomain` - 创建知识域
- `GET /api/ee/knowledgeDomain` - 查询知识域列表
- `PUT /api/ee/knowledgeDomain/:id` - 更新知识域
- `DELETE /api/ee/knowledgeDomain/:id` - 删除知识域

#### 3.2 知识库管理
- `POST /api/ee/knowledgeBase` - 创建知识库
- `GET /api/ee/knowledgeBase` - 查询知识库列表
- `PUT /api/ee/knowledgeBase/:id` - 更新知识库
- `DELETE /api/ee/knowledgeBase/:id` - 删除知识库

#### 3.3 向量化内容管理
- `POST /api/ee/vectorizedContent` - 创建向量化内容
- `GET /api/ee/vectorizedContent` - 查询向量化内容
- `PUT /api/ee/vectorizedContent/:id` - 更新向量化内容
- `DELETE /api/ee/vectorizedContent/:id` - 删除向量化内容

## 使用指南

### 1. 创建供应链知识库

#### 步骤1: 创建知识域
1. 进入知识库管理页面
2. 点击"新建知识域"
3. 填写域名称："供应链"
4. 添加描述和配置主题色
5. 保存知识域

#### 步骤2: 创建知识库
1. 选择刚创建的"供应链"域
2. 点击"新建知识库"
3. 填写知识库名称和描述
4. 选择向量化模型（如text-embedding-ada-002）
5. 配置分块参数
6. 保存知识库

#### 步骤3: 选择内容进行向量化
1. 选择刚创建的知识库
2. 在内容库中选择相关文档
3. 点击"向量化"按钮
4. 系统自动处理并生成向量

### 2. 配置向量化参数

#### 分块大小 (chunkSize)
- **小分块 (500-1000字符)**: 适合精确检索，但可能丢失上下文
- **中等分块 (1000-2000字符)**: 平衡检索精度和上下文完整性
- **大分块 (2000+字符)**: 保留更多上下文，但检索精度可能降低

#### 分块重叠 (chunkOverlap)
- **无重叠 (0字符)**: 分块间完全独立
- **小重叠 (100-200字符)**: 避免关键信息被分割
- **大重叠 (300+字符)**: 确保上下文连续性

### 3. 向量化模型选择

#### OpenAI text-embedding-ada-002
- **维度**: 1536
- **优势**: 性能稳定，支持多语言
- **适用场景**: 通用文本向量化

#### 其他模型
- 可根据具体需求选择不同的向量化模型
- 支持自定义模型配置

## 扩展功能

### 1. 智能检索
- 支持语义搜索
- 支持多模态检索（文本、图片、音频）
- 支持混合检索（关键词+语义）

### 2. 知识图谱
- 构建实体关系图
- 支持知识推理
- 可视化知识结构

### 3. 知识更新
- 支持增量更新
- 版本控制
- 变更追踪

### 4. 权限管理
- 基于角色的访问控制
- 知识库级别的权限管理
- 审计日志

## 最佳实践

### 1. 内容组织
- 按业务领域合理划分知识域
- 保持知识库的单一职责
- 定期清理和更新内容

### 2. 向量化策略
- 根据内容特点选择合适的分块大小
- 设置合理的重叠参数
- 定期评估向量化质量

### 3. 性能优化
- 合理设置分块大小，避免过大的向量数据
- 使用索引优化检索性能
- 定期清理无效的向量化内容

### 4. 监控和维护
- 监控向量化成功率
- 跟踪检索性能指标
- 定期备份和恢复数据

## 故障排除

### 1. 常见问题

#### 向量化失败
- 检查向量化模型配置
- 验证内容格式是否正确
- 检查网络连接和API密钥

#### 检索结果不准确
- 调整分块大小和重叠参数
- 检查向量化模型是否合适
- 优化查询策略

#### 性能问题
- 检查数据库索引
- 优化分块策略
- 考虑使用向量数据库

### 2. 日志分析
- 查看应用日志了解错误详情
- 分析向量化性能指标
- 监控系统资源使用情况

## 总结

知识库系统为智能物联网平台提供了强大的知识管理能力。通过合理的架构设计和配置，可以构建高效、准确的知识检索系统，为AI应用提供可靠的知识支持。

系统的模块化设计使得扩展和维护变得简单，而灵活的配置选项则能够适应不同业务场景的需求。随着AI技术的发展，知识库系统将继续演进，为用户提供更好的知识服务体验。
